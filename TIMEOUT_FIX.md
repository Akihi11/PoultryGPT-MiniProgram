# ⏰ 云函数超时问题解决指南

## 问题描述

当前错误：`errCode: -504003 | errMsg: Invoking task timed out after 3 seconds`

这个错误表示云函数执行时间超过了默认的 3 秒限制。

## 🔧 解决方案

### 方案 1: 重新部署云函数（推荐）

1. **右键点击 `cloudfunctions/dify-chat` 目录**
2. **选择 "上传并部署：云端安装依赖"**
3. **等待部署完成**

> 💡 **说明**：新部署的云函数会自动使用 `config.json` 中的 30 秒超时设置。

### 方案 2: 手动设置云函数超时时间

如果方案 1 不起作用，可以手动设置：

1. **打开微信开发者工具**
2. **点击 "云开发" 按钮**
3. **进入 "云函数" 页面**
4. **找到 `dify-chat` 函数**
5. **点击 "配置"**
6. **设置超时时间为 30 秒**
7. **保存配置**

### 方案 3: 优化请求策略

如果仍然超时，可以尝试：

1. **发送更简短的问题**
2. **避免复杂的工作流**
3. **检查 Dify 应用是否已发布**

## 📋 检查清单

请确认以下配置：

- [ ] 云函数已重新部署
- [ ] 超时时间设置为 30 秒
- [ ] Dify 应用已发布（开发环境或生产环境）
- [ ] 网络连接正常

## 🔍 常见问题

### 问题 1: 重新部署后仍然超时

**解决方案：**

1. 检查云函数配置是否正确
2. 确认 Dify 应用状态
3. 尝试发送简单的问题测试

### 问题 2: 超时时间设置不生效

**解决方案：**

1. 手动在云开发控制台设置
2. 删除云函数重新创建
3. 检查配置文件格式

### 问题 3: 特定问题总是超时

**解决方案：**

1. 简化问题描述
2. 避免复杂的上下文
3. 检查 Dify 工作流配置

## 🎯 成功标志

修复成功后，你应该能看到：

- ✅ 云函数不再超时
- ✅ 能够正常发送消息并收到回复
- ✅ 响应时间在合理范围内（通常 5-15 秒）

## 📞 需要帮助？

如果按照上述步骤仍然有问题：

1. 检查云开发控制台的错误日志
2. 确认 Dify 应用配置
3. 尝试简化测试问题
4. 联系技术支持

## 🚀 下一步

超时问题解决后：

1. 测试各种类型的问题
2. 验证会话历史功能
3. 优化用户体验

修复超时问题后，你的小程序就能正常使用 Dify AI 聊天功能了！
