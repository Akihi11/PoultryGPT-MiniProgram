<!--settings.wxml-->
<view class="settings-container">
  <!-- 顶部标题栏 -->
  <view class="header gradient-bg">
    <view class="back-button" bindtap="goBack">
      <t-icon name="chevron-left" size="40rpx" color="white" />
    </view>
    <view class="header-title">设置</view>
    <view class="header-spacer"></view>
  </view>
  
  <!-- 设置内容 -->
  <scroll-view class="settings-content" scroll-y="true" enable-flex="true">
    <!-- 第一组：账号管理 -->
    <view class="settings-group shadow-sm border-radius-12">
      <t-cell-group>
        <t-cell 
          title="账号管理" 
          arrow
          bind:click="openAccountManagement"
          left-icon="user"
        />
      </t-cell-group>
    </view>
    
    <!-- 第二组：应用设置 -->
    <view class="settings-group shadow-sm border-radius-12">
      <t-cell-group>
        <!-- 外观设置 -->
        <view class="appearance-cell">
          <view class="cell-left">
            <t-icon name="palette" size="32rpx" color="#6b7280" class="cell-icon" />
            <text class="cell-title">外观</text>
          </view>
          <view class="appearance-controls">
            <view class="theme-option {{currentTheme === 'light' ? 'active' : ''}}" bindtap="setTheme" data-theme="light">
              白天
            </view>
            <view class="theme-option {{currentTheme === 'dark' ? 'active' : ''}}" bindtap="setTheme" data-theme="dark">
              夜晚
            </view>
            <view class="theme-option {{currentTheme === 'auto' ? 'active' : ''}}" bindtap="setTheme" data-theme="auto">
              跟随系统
            </view>
          </view>
        </view>
        
                 <!-- 语言设置 -->
         <view class="appearance-cell">
           <view class="cell-left">
             <t-icon name="globe" size="32rpx" color="#6b7280" class="cell-icon" />
             <text class="cell-title">语言</text>
           </view>
           <view class="appearance-controls">
             <view class="theme-option {{currentLanguage === 'zh' ? 'active' : ''}}" bindtap="setLanguage" data-language="zh">
               中文
             </view>
             <view class="theme-option {{currentLanguage === 'en' ? 'active' : ''}}" bindtap="setLanguage" data-language="en">
               English
             </view>
           </view>
         </view>
         
         <!-- 知识库设置 -->
         <view class="appearance-cell">
           <view class="cell-left">
             <t-icon name="folder" size="32rpx" color="#6b7280" class="cell-icon" />
             <text class="cell-title">知识库</text>
           </view>
           <view class="appearance-controls">
             <view class="theme-option" bindtap="openKnowledgeBase">
               管理
             </view>
           </view>
         </view>
      </t-cell-group>
    </view>
    
    <!-- 第三组：关于和帮助 -->
    <view class="settings-group shadow-sm border-radius-12">
      <t-cell-group>
        <t-cell 
          title="关于 PoultryGPT" 
          arrow
          bind:click="openAbout"
          left-icon="info-circle"
        />
        
        <t-cell 
          title="GitHub" 
          arrow
          bind:click="openGitHub"
          left-icon="logo-github"
        >
          <view slot="note">
            <t-icon name="link" size="24rpx" color="#6b7280" />
          </view>
        </t-cell>
      </t-cell-group>
    </view>
    
    <!-- 第四组：其他设置 -->
    <view class="settings-group shadow-sm border-radius-12">
      <t-cell-group>
        <t-cell title="通知设置" left-icon="notification">
          <t-switch 
            slot="note"
            value="{{notificationEnabled}}" 
            bind:change="onNotificationChange"
            size="small"
          />
        </t-cell>
        
        <t-cell title="自动保存对话" left-icon="save">
          <t-switch 
            slot="note"
            value="{{autoSaveEnabled}}" 
            bind:change="onAutoSaveChange"
            size="small"
          />
        </t-cell>
        
        <t-cell 
          title="清除缓存" 
          arrow
          bind:click="clearCache"
          left-icon="delete"
        />
      </t-cell-group>
    </view>
  </scroll-view>
  
  <!-- 退出登录 -->
  <view class="logout-section">
    <t-button 
      theme="danger" 
      size="large" 
      block
      bind:tap="showLogoutConfirm"
      class="logout-button"
    >
      退出登录
    </t-button>
  </view>
</view>

<!-- 退出登录确认弹窗 -->
<t-dialog 
  visible="{{logoutDialogVisible}}" 
  title="退出登录"
  bind:confirm="confirmLogout"
  bind:cancel="hideLogoutConfirm"
  confirm-btn="退出"
  cancel-btn="取消"
>
  <view class="logout-dialog-content">
    确定要退出登录吗？退出后需要重新登录才能使用。
  </view>
</t-dialog>

<!-- 语言选择弹窗 -->
<t-action-sheet 
  visible="{{languageSheetVisible}}" 
  items="{{languageOptions}}"
  bind:selected="onLanguageSelect"
  bind:cancel="hideLanguageSheet"
/>

<!-- 关于应用弹窗 -->
<t-dialog 
  visible="{{aboutDialogVisible}}" 
  title="关于 PoultryGPT"
  bind:confirm="hideAboutDialog"
  confirm-btn="确定"
  show-cancel="{{false}}"
>
  <view class="about-dialog-content">
    <view class="about-version">版本：1.0.0</view>
    <view class="about-description">一个专业的家禽养殖AI助手</view>
    <view class="about-copyright">© 2024 PoultryGPT Team</view>
  </view>
</t-dialog>

<!-- 清除缓存确认弹窗 -->
<t-dialog 
  visible="{{clearCacheDialogVisible}}" 
  title="清除缓存"
  bind:confirm="confirmClearCache"
  bind:cancel="hideClearCacheDialog"
  confirm-btn="清除"
  cancel-btn="取消"
>
  <view class="clear-cache-dialog-content">
    确定要清除所有缓存数据吗？这将删除本地保存的聊天记录和设置。
  </view>
</t-dialog>

<!-- Toast提示 -->
<t-toast id="t-toast" />
